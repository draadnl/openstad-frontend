{% import 'phase-voting/ideas-list.html' as ideasList %}
{% import 'phase-voting/budgeting.html' as budgeting %}

{% set pageTitle    = 'Stemmen' %}
{% set contentClass = 'ideasList' %}
{% set activeMenu   = 'budget' %}

<div class="hide-when-loaded" style="text-align: center; padding: 30px 0;">
	{{ __('Loading...') }}
</div>

<div id="westbegroot-voting" class="begroot-container opacity-0-for-load">

	{% if data.widget.voting %}
	{{ budgeting.showBudgetWindow(data) }}
	{% endif %}

	<script>
	 var userHasVoted = {{data.widget.userHasVoted}};
	 {% if data.widget.allowAnonymousVotes %}
	   var userIsLoggedIn = {{true if (data.loggedIn or (data.openstadUser and data.openstadUser.role == 'anonymous')) else false}};
	 {% else %}
	   var userIsLoggedIn = {{true if data.loggedIn else false}};
	 {% endif %}
	 var authServerLogoutUrl = '{{authServerLogoutUrl}}';
	 var defaultSort = 'random'; //	{% if config.budgeting.isActive %}'random'{% else %}'ranking'{% endif %}
	 var siteId = '{{data.global.siteId}}';

	 var votingType = '{{data.widget.votingType}}'; // budgeting or count
	 var maxIdeas = {{data.widget.maxIdeas if data.widget.maxIdeas else 0}};
	 var minIdeas = {{data.widget.minIdeas if data.widget.minIdeas else 0}};

	 var initialAvailableBudget = {{data.widget.initialAvailableBudget if data.widget.initialAvailableBudget else 0}};
	 var minimalBudgetSpent = {{data.widget.minimalBudgetSpent if data.widget.minimalBudgetSpent else 0}};

	</script>

  {% if (data.widget.votingType == 'budgeting-per-theme' and data.global.themes and data.global.themes.length > 0) %}
  <style>
	 {% for theme in data.global.themes %}
   .theme-{{theme.color | replace("#", "")}} {
     color: white;
     background-color: {{theme.color}};
     border: 0px solid {{theme.color}};
   }
   #budget-block #themes-buttons .theme-{{theme.color | replace("#", "")}}.active {
     border-width: 2px;
     border-color: {{theme.color}};
   }
	 {% endfor %}
  </style>
  <script>
   var themes = [
     {
       value: "No theme selected"
     },
	   {% for theme in data.global.themes %}
     {
       value: '{{theme.value | stripSafe | safe}}',
       initialAvailableBudget: parseInt({{theme.initialAvailableBudget}}) || 300000,
       minimalBudgetSpent: typeof parseInt({{theme.minimalBudgetSpent}}) == 'number' ? parseInt({{theme.minimalBudgetSpent}}) : 200000,
       availableBudgetAmount: 0,
       className: 'theme-{{theme.color | replace("#", "")}}',
       currentSelection: [],
     },
	   {% endfor %}
   ];
  </script>
  {% endif %}

	<div id="ideasList" class="pageContent {{contentClass}}">

		{{ ideasList.showIdeasList(data.widget.acceptedIdeas, fullHost, user, userHasVoted, isAdmin, data) }}
	</div>
</div>
