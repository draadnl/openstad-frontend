{% set pageTitle = 'Jouw plan insturen' %}
{% set showForm = true %}

{% if data.idea %}
{% set idea = data.idea %}
{% endif %}

{% if data.activeResource %}
{% set idea = data.activeResource %}
{% endif %}

{% set isOwner = data.openstadUser.id === idea.userId %}
{% set isReactedTo = (idea.yes > 0 or idea.no > 0 or idea.argumentCount > 0) %}
{% set notReactedTo =  not isReactedTo %}
{% set isOwnerOrAdmin = (notReactedTo or not data.widget.hideAdminAfterPublicAction and isOwner) or data.hasModeratorRights %}


{% if idea and isOwnerOrAdmin %}
{% set showForm = true %}
{% elseif (not idea) and data.openstadUser and data.openstadUser.id %}
{% set showForm = true %}
{% else %}
{% set showForm = true %}
{% endif %}

{% if data.widget.editorDescription %}
{% set useModernEditor = true %}
{% else %}
{% set useModernEditor = false %}
{% endif %}
<div class="pageContent newIdea" id="content">
	{% if not showForm %}
	<div class="box-grey">
		<h1>Om een plan in te dienen moet je ingelogd zijn.</h1>
		<p>Klik <a href="{{data.siteUrl}}/oauth/login">hier</a> om in te loggen.</p>
	</div>
	{% elseif showForm %}
		<div  id="formulier-block">
			{% if data.widget.formType === 'dynamic' %}
			{% include 'includes/dynamic-form.html' %}
			{% else %}
			{% include 'includes/static-form.html' %}
			{% endif %}
		</div>

		{% if idea %}
		<br />
		{#
		<div style="background: #efefef; padding: 5px 30px; margin: 60px 0 20px;">
			<div class="row">
				<div class="col-xs-12">
					<h4> Beheren </h4>
				</div>
				{% if data.hasModeratorRights %}
				<div class="col-sm-8 col-xs-12">

				<form method="POST" class="idea-status-form" action="{{data.siteUrl}}/modules/idea-form-widgets/submit">
					<input type="hidden" name="action" value="UPDATE_STATUS">
					<div class="row">
						<div class="col-xs-6">
							<select name="status"  class="button status default-select">
								<option {{'selected' if idea.status=='OPEN'}}     value="OPEN">    Status: Open</option>
								<option {{'selected' if idea.status=='CLOSED'}}     value="CLOSED">    Status: Gesloten</option>
								<option {{'selected' if idea.status=='DENIED'}}   value="DENIED">  Status: Afgewezen</option>
							</select>
						</div>
						<div class="col-xs-6">
							<input type="submit" value="Opslaan" style=" float: none;" onclick="return confirm('Zeker?')">
						</div>
					</div>


					<input type="hidden" name="ideaId" value="{{idea.id}}">
					<input type="hidden" name="_method" value="PUT">
				</form>
				</div>
				{% endif %}
				<div class="col-sm-4 col-xs-12">
				  <form method="post" class="idea-delete-form" action="{{data.siteUrl}}/modules/idea-form-widgets/submit" >
					  <input type="hidden" name="idea-delete-redirect-uri" class="idea-delete-redirect-uri"  value="/{{data.global.ideaOverviewSlug}}" />

					  <input type="hidden" name="ideaId" value="{{idea.id}}">
					  <input type="hidden" name="action" value="DELETE">
					  <input type="submit" value="Plan verwijderen" style="background: red; float: none;" onclick="return confirm('Zeker?')">
				  </form>
				</div>

		    <!--		<form method="GET" action="{{data.siteUrl}}/plan/{{idea.id}}/mod_break">
					   <button type="submit" class="modBreak">Moderator reactie</button>
				     </form>
	           !-->
			</div>

		</div>
		#}
		{% endif %}
	  {% endif %}
</div>
<!-- Todo: Use the play of apostrophe method in main.js, these variables are not needed anymore  -->
<script>
  var titleMinLength = parseInt('{{data.widget.minTitle}}');
  var titleMaxLength = parseInt('{{data.widget.maxTitle}}');
  var summaryMinLength = parseInt('{{data.widget.minSummary}}');
  var summaryMaxLength = parseInt('{{data.widget.maxSummary}}');
  var descriptionMinLength = parseInt('{{data.widget.minDescription}}');
  var descriptionMaxLength = parseInt('{{data.widget.maxDescription}}');
</script>

<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/trix.js"></script>
<!--<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/browser-polyfill.min.js"></script>-->
<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/filepond-polyfill.min.js"></script>
<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/filepond.js"></script>

<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/filepond-plugin-image-preview.js"></script>
<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/filepond-plugin-file-validate-type.js"></script>
<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/filepond-plugin-file-validate-size.js"></script>
<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/filepond-plugin-file-poster.js"></script>
<script src="{{data.siteUrl}}/modules/openstad-assets/js/vendor/filepond-plugin-image-exif-orientation.js"></script>
