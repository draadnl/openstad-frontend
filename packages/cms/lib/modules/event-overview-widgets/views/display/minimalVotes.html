{% set columns = 3 %}

<div
class="tile-list events-list list "
{% if data.widget.defaultSorting %}
data-default-sort="{{data.widget.defaultSorting}}"
{% endif %}
>
  <div class="flex-col flex-col-{{columns}}">

    {% set displayVoteForCount = false  %}
    {% set displayVoteAgainstCount = false  %}
    {% for voteValue in data.widget.siteConfig.voteValues %}
    {% if voteValue.value == 'yes' %}
    {% set displayVoteForCount = true  %}
    {% else %}
    {% set displayVoteAgainstCount = true  %}
    {% endif %}
    {% endfor %}

    {% for event in data.widget.activeEvents %}

    {# TODO: this should be moved to the widget load method #}
    {% if data.widget.pathForResource and data.widget.pathForResource.includes(':id') %}
    {% set eventUrl = data.widget.pathForResource.replace(':id', event.id) %}
    {% elseif data.widget.pathForResource and data.widget.pathForResource.includes('\{eventId\}') %}
    {% set eventUrl = data.widget.pathForResource.replace('\{eventId\}', event.id) %}
    {% else %}
    {% set eventUrl = data.widget.pathForResource + '/' + event.id %}
    {% endif %}
    <div
    class="tile event-item list-item {{event.status}} {{'USER' if data.openstadUser.id === event.userId}} theme-{{event.extraData.theme | slugify}} {{data.widget.cardStyle}}"
    data-createdtime="{{data.widget.parseDateToTime(event.createdAt)}}"
    data-likes="{{event.yes}}"
    data-budget="{{event.budget}}"
    data-ranking="{{event.ranking}}"
    data-eventid="{{event.id}}"
    data-theme="{{event.extraData.theme}}"
    data-area="{{event.extraData.area}}"
    >

      <a href="{{eventUrl | safeRelativeUrl}}">
        {% if data.widget.displayRanking and event.status != 'DENIED' and event.ranking %}
        <div class="ranking"><div class="label">{{event.ranking}}</div></div>
        {% endif %}

        <div class="image" style="background-image: url('{{data.widget.formatImageUrl(event.extraData.images[0], event.location, data.widget, 500, 500, true, data.cookieConsent) }}')"></div>

        {% if data.widget.displayLabel %}
        <div class="duration">
          {{ data.widget['label' + event.status] | replace("[countdown]", event.countdown or "0") | replace(" 1 dagen", " 1 dag") }}
        </div>
        {% endif %}

        <div class="info">

          {% if data.widget.displayTitle %}
          <h3 class="title">{{event.title}}</h3>
          {% endif %}

          {% if data.widget.displayTheme and event.extraData.theme %}
          <div class="thema">{{event.extraData.theme}}</div>
          {% endif %}

          {% if data.widget.displayArea and event.extraData.area %}
          <div class="gebied">{{event.extraData.area}}</div>
          {% endif %}

          {% if data.widget.displaySummary and event.summary %}
          <p class="summary">{{event.summary | sanitize | safe | truncate(data.widget.amountCharsSummary) }}</p>
          {% endif %}

	        {% if data.widget.siteConfig.minimumYesVotes and data.widget.siteConfig.voteValues and data.widget.siteConfig.voteValues.length >= 1 %}
          <div class="eventProgress">
            <div class="progress">
              <div class="bar {{event.status}}" style="width: {{event.progress}}%;">
                <span class="sr-only">Aantal stemmen voor het plan: {{event.yes}} van de {{data.global.siteConfig.events.minimumYesVotes}}.</span>
              </div>
            </div>
          </div>
          {% endif %}

          <div class="eventStats">
            <table width="100%" border="0" celpadding="0" cellspacting="0">
              <tr>
                <td align="left">
                  {% if displayVoteForCount %}
                  {% if (event.status === 'OPEN' and data.widget.allowVotingInOverview) %}
                  <form method="POST" action="{{data.siteUrl}}/api/site/{{data.global.siteId}}/vote " class="ajax-form ajax-refresh-after-submit {{'voted' if event.userVote.opinion == 'yes'}}">
                    <input type="hidden" value="{{event.id}}" name="eventId" />
                    <input type="hidden" value="yes" name="opinion" />

                    <button
                    data-return-to="{{data.currentPathname}}?voteOpinion=yes&eventId={{event.id}}&redirectUrl={{data.currentPathname}}"
                    type="submit"
                    class="count yes role-required-{{data.global.roleToLike if data.global.roleToLike else 'anonymous'}}"
                    >
                      {{event.yes}}
                    </button>
                  </form>
                  {% else %}
                  <div class="count yes"><span class="sr-only">Stemmen voor: </span>{{event.yes}}<span class="sr-only">. </span></div>
                  {% endif %}
                  {% endif %}
                </td>

                {% if displayVoteAgainstCount %}
                <td align="center">
                  {% if (event.status === 'OPEN' and data.widget.allowVotingInOverview) %}
                  <form method="POST" action="{{data.siteUrl}}/api/site/{{data.global.siteId}}/vote " class="ajax-form ajax-refresh-after-submit {{'voted' if event.userVote.opinion == 'no'}}">
                    <input type="hidden" value="{{event.id}}" name="eventId" />
                    <input type="hidden" value="no" name="opinion" />

                    <button
                    data-return-to="{{data.currentPathname}}?voteOpinion=no&eventId={{event.id}}&redirectUrl={{data.currentPathname}}"
                    type="submit"
                    class="count no role-required-{{data.global.roleToLike if data.global.roleToLike else 'anonymous'}}"
                    >
                      {{event.no}}
                    </button>
                  </form>
                  {% else %}
                  <div class="count no"><span class="sr-only">Stemmen tegen: </span>{{event.no}}</div>
                  {% endif %}
                </td>
                {% endif %}

                {% if data.widget.displayArgumentsCount %}
                <td align="right"><div class="count arguments">{{event.argCount}}</div></td>
                {% endif %}
              </tr>
            </table>
          </div>
        </div>
      </a>
    </div>

    {% if loop.index % columns === 0 %}
  </div>
  <div class="flex-col flex-col-{{columns}}">
    {% endif %}
{% endfor %}
</div>
</div>
